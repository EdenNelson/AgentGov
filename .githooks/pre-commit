#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

repo_root=$(git rev-parse --show-toplevel)
script_path="${repo_root}/.github/scripts/validate-skills.sh"

if [[ ! -x "${script_path}" ]]; then
  printf '%s\n' "Skills validator not found or not executable: ${script_path}" >&2
  exit 1
fi

changed_files=$(git diff --cached --name-only)
if [[ -z "${changed_files}" ]]; then
  exit 0
fi

if ! printf '%s\n' "${changed_files}" | grep -q '^\.github/skills/.*/SKILL\.md$'; then
  exit 0
fi

"${script_path}"
